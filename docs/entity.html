<!DOCTYPE html>  <html> <head>   <title>entity.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation.html">                 animation.coffee               </a>                                           <a class="source" href="cider.html">                 cider.coffee               </a>                                           <a class="source" href="clock.html">                 clock.coffee               </a>                                           <a class="source" href="entity.html">                 entity.coffee               </a>                                           <a class="source" href="game.html">                 game.coffee               </a>                                           <a class="source" href="gamecontroller.html">                 gamecontroller.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="level.html">                 level.coffee               </a>                                           <a class="source" href="levelLoader.html">                 levelLoader.coffee               </a>                                           <a class="source" href="loader.html">                 loader.coffee               </a>                                           <a class="source" href="map.html">                 map.coffee               </a>                                           <a class="source" href="modernizr.html">                 modernizr.coffee               </a>                                           <a class="source" href="platformerEntity.html">                 platformerEntity.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               entity.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Entity</span>
  <span class="nv">constructor: </span><span class="nf">(@game, options = {}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>_entityId is used internally by Cider for things like notifying entities of collisions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@_entityId = </span><span class="nx">@game</span><span class="p">.</span><span class="nx">createEntity</span> <span class="k">this</span>

    <span class="vi">@tagName = </span><span class="s">&#39;div&#39;</span>
    <span class="vi">@className = </span><span class="s">&#39;&#39;</span>
    <span class="vi">@id = </span><span class="s">&#39;&#39;</span>
    <span class="vi">@pos = </span><span class="p">{</span><span class="nv">x: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">y: </span><span class="mi">0</span><span class="p">}</span>
    <span class="vi">@vel = </span><span class="p">{</span><span class="nv">x: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">y: </span><span class="mi">0</span><span class="p">}</span>
    <span class="vi">@zIndex = </span><span class="mi">99</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Properties used for drawing and Box2D body creation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@size = </span><span class="p">{</span><span class="nv">x: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">y: </span><span class="mi">0</span><span class="p">}</span>
    <span class="vi">@angle = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Properties for Box2D body creation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@angularDamping = </span><span class="mi">0</span>
    <span class="vi">@linearDamping = </span><span class="mi">0</span>
    <span class="vi">@gravityScale = </span><span class="mi">1</span>
    <span class="vi">@fixedRotation = </span><span class="kc">false</span> <span class="nx">unless</span> <span class="nx">@fixedRotation</span><span class="o">?</span>
    <span class="vi">@bodyType = </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Properties for Box2D fixture creation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@density = </span><span class="mi">1</span>
    <span class="vi">@restitution = </span><span class="mi">0</span> <span class="nx">unless</span> <span class="nx">@restitution</span><span class="o">?</span>
    <span class="vi">@friction = </span><span class="mf">0.5</span> <span class="nx">unless</span> <span class="nx">@friction</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Overwrite defaults with any passed options.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">c</span><span class="p">.</span><span class="nx">extend</span> <span class="k">this</span><span class="p">,</span> <span class="nx">options</span>

    <span class="nx">@createBody</span><span class="p">()</span>
    <span class="nx">@createElement</span><span class="p">()</span>
    <span class="nx">@initializeElement</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>vel
accel</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createBody: </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Create a Box2D body and fixture for our physics simulation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bodyDef = </span><span class="k">new</span> <span class="nx">b2BodyDef</span>

    <span class="nv">bodyDef.position = </span><span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">@pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">@pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span>
    <span class="p">)</span>
    <span class="nv">bodyDef.type = </span><span class="nx">@bodyType</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Set up userData on bodyDef so we can trace the body back to its Cider object (for collision and stuff).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bodyDef.userData = </span><span class="nx">@_entityId</span>

    <span class="nv">bodyDef.angularDamping = </span><span class="nx">@angularDamping</span>
    <span class="nv">bodyDef.linearDamping = </span><span class="nx">@linearDamping</span>
    <span class="nv">bodyDef.gravityScale = </span><span class="nx">@gravityScale</span>
    <span class="nv">bodyDef.fixedRotation = </span><span class="nx">@fixedRotation</span>

    <span class="vi">@body = </span><span class="nx">@game</span><span class="p">.</span><span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span> <span class="nx">bodyDef</span>

    <span class="nv">fixtureDef = </span><span class="k">new</span> <span class="nx">b2FixtureDef</span>

    <span class="nv">fixtureDef.density = </span><span class="nx">@density</span>
    <span class="nv">fixtureDef.friction = </span><span class="nx">@friction</span>
    <span class="nv">fixtureDef.restitution = </span><span class="nx">@restitution</span>

    <span class="nv">fixtureDef.shape = </span><span class="k">new</span> <span class="nx">b2PolygonShape</span>
    <span class="nx">fixtureDef</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">SetAsBox</span><span class="p">(</span>
      <span class="nx">@size</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span><span class="p">,</span>
      <span class="nx">@size</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span>
    <span class="p">)</span>

    <span class="nx">@body</span><span class="p">.</span><span class="nx">CreateFixture</span> <span class="nx">fixtureDef</span>

  <span class="nv">createElement: </span><span class="o">=&gt;</span>
    <span class="nv">el = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="nx">@tagName</span>
    <span class="nv">el.className = </span><span class="nx">@className</span>
    <span class="nv">el.id = </span><span class="nx">@id</span>

    <span class="vi">@el = </span><span class="nx">el</span>

  <span class="nv">initializeElement: </span><span class="o">=&gt;</span>
    <span class="nv">es = </span><span class="nx">@el</span><span class="p">.</span><span class="nx">style</span>
    <span class="nv">es.position = </span><span class="s">&#39;absolute&#39;</span>
    <span class="nv">es.zIndex = </span><span class="nx">@zIndex</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>es.WebkitPerspective = 1000
es.WebkitBackfaceVisibility = 'hidden'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@game</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@el</span>

  <span class="nv">drawElement: </span><span class="o">=&gt;</span>
    <span class="nv">es = </span><span class="nx">@el</span><span class="p">.</span><span class="nx">style</span>

    <span class="nv">es.left = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="s">px&quot;</span>
    <span class="nv">es.top = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="s">px&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>es[c.prefixed.transform] = "translate3d(#{@pos.x}px, #{@pos.y}px, 0px)"</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">es.width = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@size</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">px&quot;</span>
    <span class="nv">es.height = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@size</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="s">px&quot;</span>
    <span class="nv">es.WebkitTransform = </span><span class="s">&quot;rotate(</span><span class="si">#{</span><span class="nx">@angle</span><span class="si">}</span><span class="s">deg)&quot;</span>

  <span class="nv">setAnim: </span><span class="p">(</span><span class="nx">anim</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="vi">@currentAnim = </span><span class="nx">anim</span>
    <span class="vi">@el.style.backgroundImage = </span><span class="s">&quot;url(</span><span class="si">#{</span><span class="nx">anim</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span><span class="s">)&quot;</span>

  <span class="nv">update: </span><span class="o">=&gt;</span>
    <span class="nv">body = </span><span class="nx">@body</span>
    <span class="nv">newPos = </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">()</span>
    <span class="nv">newVel = </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">@currentAnim</span> <span class="k">then</span> <span class="nx">@currentAnim</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Update physics properties and position needed for drawing based on Box2D data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@angle = </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>
    <span class="vi">@pos.x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">newPos</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span><span class="p">)</span>
    <span class="vi">@pos.y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">newPos</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">c</span><span class="p">.</span><span class="nx">b2Scale</span><span class="p">)</span>
    <span class="vi">@vel.x = </span><span class="nx">newVel</span><span class="p">.</span><span class="nx">x</span>
    <span class="vi">@vel.y = </span><span class="nx">newVel</span><span class="p">.</span><span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This gets called by the game when this entity collides with something else. By default, it's a noop; you'll probably want to make it do something interesting.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collidePost: </span><span class="p">(</span><span class="nx">other</span><span class="p">,</span> <span class="nx">impulse</span><span class="p">)</span> <span class="o">=&gt;</span>


  <span class="nv">collidePre: </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span> <span class="o">=&gt;</span>


  <span class="nv">contactBegin: </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span> <span class="o">=&gt;</span>


  <span class="nv">contactEnd: </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Call this when your entity has died, or needs to be removed for some other reason. You can do animations or whatever else you need in here, but remember to call <code>parent</code>!</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="o">=&gt;</span>
    <span class="nx">@_destroyElement</span><span class="p">()</span>
    <span class="nx">@game</span><span class="p">.</span><span class="nx">destroyEntity</span> <span class="k">this</span>

  <span class="nv">_destroyElement: </span><span class="o">=&gt;</span>
    <span class="nx">@game</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@el</span>

  <span class="nv">draw: </span><span class="o">=&gt;</span>
    <span class="nx">@drawElement</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@currentAnim</span> <span class="k">then</span> <span class="nx">@currentAnim</span><span class="p">.</span><span class="nx">draw</span> <span class="k">this</span>

  <span class="nv">setStyle: </span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 